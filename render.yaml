services:
  # Python Server (Game Logic & HTML)
  - type: web
    name: python-server
    env: python
    plan: free
    buildCommand: |
      cd python-server
      pip install -r requirements.txt
    startCommand: |
      cd python-server
      gunicorn app:app --bind 0.0.0.0:5001
    envVars:
      - key: DB_PASS
        sync: false # User must provide this in dashboard for security
      - key: PORT
        value: 5001

  # Go Server (WebSocket & Proxy)
  - type: web
    name: go-server
    env: go
    plan: free
    buildCommand: |
      cd go-server
      go build -o main .
    startCommand: |
      cd go-server
      ./main -addr :$PORT
    envVars:
      - key: PYTHON_SERVER_URL
        fromService:
          type: web
          name: python-server
          property: host
          # Render internal URL usually doesn't include protocol, so we might need to prepend http://
          # But 'host' property usually returns host:port. 
          # Let's use a value string construction if possible, or just hardcode the internal name.
          # Better approach:
      - key: PYTHON_SERVER_URL
        value: http://python-server:5001
